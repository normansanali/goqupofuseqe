<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.: We have recently upgraded our Prometheus server from 1.8 to 2.2.1."><meta name=generator content="Hugo 0.98.0"><meta name=robots content="index,follow,noarchive"><title>How do I delete a time series from Prometheus v2, specifically a series of alerts &#183;</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/blackburn.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel=stylesheet type=text/css><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=./img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=./index.html>JadeBlog</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=./index.html><i class="fa fa-home fa-fw"></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=./post/index.html><i class="fa fa-list fa-fw"></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=./sitemap.xml><i class="fa fa-user fa-fw"></i>Sitemap</a></li><li class=pure-menu-item><a class=pure-menu-link href=./index.xml><i class="fa fa-phone fa-fw"></i>RSS</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small>&copy; 2022. All rights reserved.</small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div></div></div><div id=main><div class=header><h1>How do I delete a time series from Prometheus v2, specifically a series of alerts</h1><h2>We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.: We have recently upgraded our Prometheus server from 1.8 to 2.2.1.</h2></div><div class=content><div class=post-meta><div><i class="fa fa-calendar fa-fw"></i>
<time>09 Aug 2024, 00:00</time></div></div><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>We are getting to grips with alerting so from time to time need to clear out old alerts which we did by calling the HTTP API, to remove the pseudo time series where the alerts were stored, e.g.:</p><pre><code>DELETE https://prometheus/api/v1/series?match[]={__name__="ALERTS"} </code></pre><p>We have recently upgraded our Prometheus server from 1.8 to 2.2.1.</p><p>Calling this endpoint now gives</p><pre><code>{ "status": "error", "errorType": "internal", "error": "not implemented" } </code></pre><p>I have done some research and found a solution in various locations, which I will summarise in an answer below in case it's of use to my fellow StackOverflowers</p><span class=d-none itemprop=commentCount></span><h2 class=mb0 data-answercount=2>2 Answers</h2><p>Firstly the admin API is not enabled by default in Prometheus 2. This must be made active by starting the server with the option</p><pre><code>--web.enable-admin-api </code></pre><p>There is a new endpoint in v2 at</p><pre><code>https://prometheus/api/v2/admin/tsdb/delete_series </code></pre><p>This takes a <code>POST</code> specifying the search criteria, e.g. for a time series with the name <code>ALERTS</code> where the alert name is <code>MyTestAlert</code>, post the following <code>application/json</code> to the <code>delete_series</code> endpoint, from the tool of choice (Tested with Postman 6 on Mac)</p><pre><code>{ "matchers": [{ "type": "EQ", "name": "__name__", "value": "ALERTS" }, { "type": "EQ", "name": "alertname", "value": "MyTestAlert" }] } </code></pre><p>For completeness and to free the disk space where the alerts were persisted, <code>POST</code> an empty payload to</p><pre><code>https://prometheus/api/v2/admin/tsdb/clean_tombstones </code></pre><p>Answer aggregated from:</p><ul><li><a href=# rel=noreferrer>https://prometheus.io/docs/prometheus/latest/querying/api/</a></li><li><a href=# rel=noreferrer>https://github.com/prometheus/prometheus/issues/3584</a></li><li><a href=# rel=noreferrer>https://groups.google.com/forum/#!msg/prometheus-users/ToMKsb9fYp8/az6afuX3CgAJ</a></li></ul><span class=d-none itemprop=commentCount>5</span><p>Curl variant:</p><pre><code># delete alerts series curl -g -XPOST 'http://prometheus:9090/api/v1/admin/tsdb/delete_series?match[]=ALERTS' # delete data from disk curl -XPOST http://prometheus:9090/api/v1/admin/tsdb/clean_tombstones </code></pre><span class=d-none itemprop=commentCount>1</span><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJoa3JwZW6Ad3yOoaawZZSkeqp5w56jnqyVYq5uwMimnGarlae2pr%2BMn6mopV2lv7C5xK2fnq2jYsNzedKpnJyhlp6worjLsmSaZaOav6qx0mamn2WRobKzwA%3D%3D</p><h4><i class="fas fa-share-alt" aria-hidden=true></i>&nbsp;Share!</h4><ul class=share-buttons><li><a href="https://www.facebook.com/sharer/sharer.php?u=%2fhow-do-i-delete-a-time-series-from-prometheus-v2-specifically-a-series-of-alert.html" target=_blank title="Share on Facebook"><i class="fab fa-facebook" aria-hidden=true></i><span class=sr-only>Share on Facebook</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://twitter.com/intent/tweet?source=%2fhow-do-i-delete-a-time-series-from-prometheus-v2-specifically-a-series-of-alert.html" target=_blank title=Tweet><i class="fab fa-twitter" aria-hidden=true></i><span class=sr-only>Tweet</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://plus.google.com/share?url=%2fhow-do-i-delete-a-time-series-from-prometheus-v2-specifically-a-series-of-alert.html" target=_blank title="Share on Google+"><i class="fab fa-google-plus" aria-hidden=true></i><span class=sr-only>Share on Google+</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.tumblr.com/share?v=3&u=%2fhow-do-i-delete-a-time-series-from-prometheus-v2-specifically-a-series-of-alert.html" target=_blank title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden=true></i><span class=sr-only>Post to Tumblr</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://pinterest.com/pin/create/button/?url=%2fhow-do-i-delete-a-time-series-from-prometheus-v2-specifically-a-series-of-alert.html" target=_blank title="Pin it"><i class="fab fa-pinterest-p" aria-hidden=true></i><span class=sr-only>Pin it</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.reddit.com/submit?url=%2fhow-do-i-delete-a-time-series-from-prometheus-v2-specifically-a-series-of-alert.html" target=_blank title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden=true></i><span class=sr-only>Submit to Reddit</span></a></li></ul><style>ul.share-buttons{list-style:none;padding:0}ul.share-buttons li{display:inline}ul.share-buttons .sr-only{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}</style><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=./joey-world-tour-html.html><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=./joey-world-tour-html.html>JoeysWorldTour - Age, Family, Bio</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24><nav class=next><a href=./faze-rugs-dog-bosley.html>FaZe Rugs Dog Bosley the Pug Has Died Due to Heart Failure</a></nav></div><div class=pure-u-1-24 style=text-align:right><a href=./faze-rugs-dog-bosley.html><i class="fa fa-chevron-right"></i></a></div></div></div></div></div><script src=https://assets.cdnweb.info/hugo/blackburn/js/ui.js></script>
<script src=https://assets.cdnweb.info/hugo/blackburn/js/menus.js></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>